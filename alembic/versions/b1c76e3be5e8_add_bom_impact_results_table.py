"""add_bom_impact_results_table

Revision ID: b1c76e3be5e8
Revises: 001_oauth_tokens
Create Date: 2025-12-10 16:41:56.222569

"""
from typing import Sequence, Union

from alembic import op
import sqlalchemy as sa
from sqlalchemy.dialects import postgresql

# revision identifiers, used by Alembic.
revision: str = 'b1c76e3be5e8'
down_revision: Union[str, None] = '001_oauth_tokens'
branch_labels: Union[str, Sequence[str], None] = None
depends_on: Union[str, Sequence[str], None] = None


def upgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.create_table('bom_impact_results',
    sa.Column('id', sa.Integer(), nullable=False),
    sa.Column('email_id', sa.Integer(), nullable=False),
    sa.Column('product_index', sa.Integer(), nullable=False),
    sa.Column('part_num', sa.String(length=100), nullable=True),
    sa.Column('product_name', sa.String(length=255), nullable=True),
    sa.Column('old_price', sa.Numeric(precision=18, scale=6), nullable=True),
    sa.Column('new_price', sa.Numeric(precision=18, scale=6), nullable=True),
    sa.Column('price_delta', sa.Numeric(precision=18, scale=6), nullable=True),
    sa.Column('price_change_pct', sa.Numeric(precision=10, scale=4), nullable=True),
    sa.Column('component_validated', sa.Boolean(), nullable=True),
    sa.Column('component_description', sa.String(length=500), nullable=True),
    sa.Column('supplier_id', sa.String(length=100), nullable=True),
    sa.Column('supplier_validated', sa.Boolean(), nullable=True),
    sa.Column('supplier_name', sa.String(length=255), nullable=True),
    sa.Column('vendor_num', sa.Integer(), nullable=True),
    sa.Column('summary', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('impact_details', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('high_risk_assemblies', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('annual_impact', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('total_annual_cost_impact', sa.Numeric(precision=18, scale=2), nullable=True),
    sa.Column('actions_required', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('can_auto_approve', sa.Boolean(), nullable=True),
    sa.Column('recommendation', sa.Text(), nullable=True),
    sa.Column('thresholds_used', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('status', sa.String(length=20), nullable=True),
    sa.Column('processing_errors', postgresql.JSONB(astext_type=sa.Text()), nullable=True),
    sa.Column('approved', sa.Boolean(), nullable=True),
    sa.Column('approved_by_id', sa.Integer(), nullable=True),
    sa.Column('approved_at', sa.DateTime(), nullable=True),
    sa.Column('approval_notes', sa.Text(), nullable=True),
    sa.Column('created_at', sa.DateTime(), nullable=False),
    sa.Column('updated_at', sa.DateTime(), nullable=False),
    sa.ForeignKeyConstraint(['approved_by_id'], ['users.id'], ),
    sa.ForeignKeyConstraint(['email_id'], ['emails.id'], ondelete='CASCADE'),
    sa.PrimaryKeyConstraint('id')
    )
    op.create_index('ix_bom_impact_email_product', 'bom_impact_results', ['email_id', 'product_index'], unique=False)
    op.create_index(op.f('ix_bom_impact_results_approved'), 'bom_impact_results', ['approved'], unique=False)
    op.create_index(op.f('ix_bom_impact_results_created_at'), 'bom_impact_results', ['created_at'], unique=False)
    op.create_index(op.f('ix_bom_impact_results_email_id'), 'bom_impact_results', ['email_id'], unique=False)
    op.create_index(op.f('ix_bom_impact_results_id'), 'bom_impact_results', ['id'], unique=False)
    op.create_index(op.f('ix_bom_impact_results_part_num'), 'bom_impact_results', ['part_num'], unique=False)
    op.create_index(op.f('ix_bom_impact_results_status'), 'bom_impact_results', ['status'], unique=False)
    # ### end Alembic commands ###


def downgrade() -> None:
    # ### commands auto generated by Alembic - please adjust! ###
    op.drop_index(op.f('ix_bom_impact_results_status'), table_name='bom_impact_results')
    op.drop_index(op.f('ix_bom_impact_results_part_num'), table_name='bom_impact_results')
    op.drop_index(op.f('ix_bom_impact_results_id'), table_name='bom_impact_results')
    op.drop_index(op.f('ix_bom_impact_results_email_id'), table_name='bom_impact_results')
    op.drop_index(op.f('ix_bom_impact_results_created_at'), table_name='bom_impact_results')
    op.drop_index(op.f('ix_bom_impact_results_approved'), table_name='bom_impact_results')
    op.drop_index('ix_bom_impact_email_product', table_name='bom_impact_results')
    op.drop_table('bom_impact_results')
    # ### end Alembic commands ###
